---
title: DTKå¸¸ç”¨å’Œæµ‹è¯•ä»£ç ç‰‡
toc: true
categories: 
  - 
    - å­¦ä¹  - Linux
  - 
    - å­¦ä¹  - qt
  - 
    - ä¸“æ  - Qtæ¨å€’é‡å­¦ç³»åˆ—
  - 
    - ä¹ æƒ¯ - ä¸ªäººé…ç½®ä¹ æƒ¯
abbrlink: b59ab8c1
date: 2020-05-14 15:30:36
permalink: /pages/1acdc2/
---



ã€€ã€€**ç®€  è¿°ï¼š**ã€€`DTK` å¸¸ç”¨å’Œæµ‹è¯•ä»£ç ç‰‡ï¼Œåœ¨ `deepin 20` æˆ– `uos 20` ä¸­ï¼Œå…¨éƒ¨ä½¿ç”¨ `DTK` å¼€å‘ï¼Œå…¶ä¸­æœ‰ä¸€äº›æ˜¯ç»å¸¸é‡åˆ°çš„å®šä½ `bug` å’Œä¿®æ”¹çš„ä»£ç ç‰‡ã€‚åœ¨æ­¤æŠ›è½¬å¼•ç‰ï¼Œæäº¤ä¸€ç‚¹å¼€å‘çš„è´¡çŒ®

<!-- more -->

[TOC]

<br>

### å¼€å‘ç¯å¢ƒï¼š

ã€€ã€€**ğŸ’»ï¼š**  `uos 20` ğŸ“ `deepin 20` ğŸ“ `gcc/g++ 8.3` ğŸ“ `gdb8.0` 

<br>

### å°† dtkwidget é¡¹ç›®æ³¨å†Œåˆ°ç³»ç»Ÿï¼š

è¿™é‡Œä»¥ `dtkwidget` ä¸ºä¾‹ï¼Œå®ƒåœ¨ç³»ç»Ÿçš„åŠ¨æ€åº“æ˜¯å­˜æ”¾è·¯å¾„ä¸º `/usr/lib/x86_64-linux-gnu/`

 <img src="https://cdn.jsdelivr.net/gh/xmuli/xmuliPic@pic/2020/20200407_134649.png" width="100%"/>



- **è§£ç­”å›¾ç‰‡ï¼š**
  ç»è¿‡æµ‹è¯•ï¼Œç³»ç»Ÿåº“å’Œ DTK é¡¹ç›®çš„ç”Ÿæˆçš„ libdtkwidget.so å®é™…ä½¿ç”¨çš„éƒ½æ˜¯ æœ€æ–°çš„ 5.xxx ç‰ˆæœ¬ï¼Œè¿™é‡Œé¢çš„æ˜¯ .so.5.1.0ï¼›ç³»ç»Ÿåº“é‡Œé¢é—ç•™ä¸‹æ¥çš„ 2.xxx ç‰ˆæœ¬å¯èƒ½æ˜¯æä¾›ç»™æŸäº›æ²¡æœ‰v20ç‰ˆæœ¬çš„é¡¹ç›®ä½¿ç”¨çš„ã€‚
- è‹¥æ˜¯æƒ³è¦ä»£ç ç‰‡ç”Ÿæ•ˆçš„è¯ï¼Œåˆ™å°†é¡¹ç›®ç”Ÿæˆçš„ .so æ–‡ä»¶æ›¿ä»£æ¢æ‰ ç³»ç»Ÿè·¯å¾„ä¸‹ï¼Œè‹¥æ˜¯æœ‰æ–°çš„æ¥å£æ”¹åŠ¨ï¼Œé‚£ä¹ˆå¯¹åº”çš„å¤´æ–‡ä»¶ä¹Ÿè¦ä¸€èµ·æ›¿æ¢æ‰



```bash
#ã€å‘½ä»¤ï¼š 5.1.0 éœ€è¦æ›¿æ¢ä¸ºå®é™…çš„æœ€å¤§ã€‘
#[æ‹·è´äºŒè¿›åˆ¶æ–‡ä»¶ï¼š]
sudo rm -rf /usr/lib/x86_64-linux-gnu/libdtkwidget.so.5.1.0

sudo cp  ../build-dtkwidget-unknown-Debug/src/libdtkwidget.so.5.1.0 /usr/lib/x86_64-linux-gnu/

#[æ‹·è´å¤´æ–‡ä»¶ï¼š]
sudo cp /home/muli/project/dtkwidget/src/widgets/dslider.h /usr/include/libdtk-5.1.0/DWidget/
```



**PSï¼ˆuos / deepinï¼‰ï¼š**

å¯¹äº `dtkwidget` é¡¹ç›®ä¼šç”Ÿæˆ `libdtkwidget.so` åŠ¨æ€åº“ï¼›ç³»ç»Ÿå­˜æ”¾è·¯å¾„ä¸º `/usr/lib/x86_64-linux-gnu/` ï¼›

é¡¹ç›® `dtkgui` ä¼šç”Ÿæˆ `libdtkgui.so` åŠ¨æ€åº“æ–‡ä»¶ï¼›ç³»ç»Ÿå­˜æ”¾è·¯å¾„ä¸º `/usr/lib/x86_64-linux-gnu/` ï¼›

é¡¹ç›® `qt5integration` ä¼šç”Ÿæˆ `libchameleon.so` åŠ¨æ€åº“æ–‡ä»¶åœ¨ `./bin/plugins/styles/libchameleon.so  ` ä¸‹ ï¼›`/usr/lib/x86_64-linux-gnu/qt5/plugins/styles/`

```bash
sudo rm -rf /usr/lib/x86_64-linux-gnu/qt5/plugins/styles/libchameleon.so
sudo cp  ./bin/plugins/styles/libchameleon.so /usr/lib/x86_64-linux-gnu/qt5/plugins/styles/
```

<br>

<br>

### åˆ¤æ–­ ç³»ç»Ÿä¸»é¢˜æ˜¯æµ…è‰²è¿˜æ˜¯æš—è‰²ï¼š

```cpp
DGuiApplicationHelper *guiAppHelp = DGuiApplicationHelper::instance();
if (guiAppHelp->themeType() == DGuiApplicationHelper::ColorType::DarkType) {  //æš—è‰²ä¸»é¢˜

} else {  //æµ…è‰²ä¸»é¢˜

}
```

<br>

### å¯¹æŸä¸€é¢œè‰²ï¼Œåœ¨æµ… / æš—ä¸»é¢˜å¯¹å…¶äº®åº¦è¿›è¡Œä¿®æ”¹ï¼š

```cpp
//DGuiApplicationHelper::toColorType è·å–é¢œè‰²çš„æ˜äº®åº¦ï¼Œå°†å…¶è½¬æ¢ä¸ºä¸»é¢˜ç±»å‹çš„æšä¸¾å€¼ã€‚

QColor lineColor(opt->palette.color(QPalette::Base));
if (DGuiApplicationHelper::toColorType(lineColor) == DGuiApplicationHelper::LightType) {  //æ­¤é¢œè‰²åœ¨æµ…è‰²ä¸»é¢˜ä¸‹ï¼Œäº®åº¦ -10
	lineColor = DGuiApplicationHelper::adjustColor(color, 0, 0, -10, 0, 0, 0, 0);
} else {  //æ­¤é¢œè‰²åœ¨æš—è‰²è‰²ä¸»é¢˜ä¸‹ï¼Œäº®åº¦ +10
	lineColor = DGuiApplicationHelper::adjustColor(color, 0, 0, +10, 0, 0, 0, 0);
}
```

<br>

### å±æ€§çš„ä½¿ç”¨ï¼š

```cpp
Q_DECLARE_METATYPE(QMargins)
par->setProperty("_d_margins", QVariant::fromValue(margins));

QMargins magins = par->property("_d_margins").value<QMargins>();
if (par->property("_d_margins").isValid())
	content->setContentsMargins(QMargins(20, 0, 20, 0));
else
	content->setContentsMargins(magins);
```

<br>

### åœ¨ paintEvent() é‡Œé¢è·å–ä¸€ä¸ªé¢œè‰²ï¼š

```cpp
void SliderStrip::paintEvent(QPaintEvent *event)
{
    Q_UNUSED(event)
    QPainter pa(this);
    auto dpa = DApplicationHelper::instance()->palette(this);
    QPen penLine = QPen(dpa.textTips(), 1);
    QPen penNumber = QPen(dpa.color(DPalette::ObviousBackground), 1);
    
    pa.set(penLine);
}
```

<br>

### å°†è‡ªå®šä¹‰é£æ ¼ åº”ç”¨äº å…¶ä»–çš„è½¯ä»¶ï¼š

```bash
qtcreator -style windows

qtcreator -style chameleon
```

<br>

### æ‰“å° QBoxLayouté‡Œé¢çš„æ‰€æœ‰å…ƒç´ ï¼š

```cpp
for (int i = 0; i < d->hBoxLayout->count(); ++i) {
    QLayoutItem *item = (QLayoutItem *)d->hBoxLayout->itemAt(i);
    qDebug()<<i<<item->widget();
}
```

<br>

### QTåˆ¤æ–­é¼ æ ‡æ˜¯å¦åœ¨æŸå­çª—å£æ§ä»¶ä¸Šæ–¹ï¼š

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­çª—å£è·å–geometryï¼Œæ˜¯ç›¸å¯¹äºçˆ¶çª—å£çš„ç›¸å¯¹ä½ç½®ï¼ŒQCursor::pos()è·å–çš„æ˜¯é¼ æ ‡ç»å¯¹ä½ç½®ï¼Œè¦ä¸å°†çˆ¶çª—å£çš„ç›¸å¯¹ä½ç½®è¿›è¡Œæ¢ç®—ï¼Œè¦ä¸å°†é¼ æ ‡çš„ç»å¯¹ä½ç½®è¿›è¡Œæ¢ç®—ï¼Œè¿™é‡Œæœ¬æ–‡é‡‡ç”¨å°†é¼ æ ‡ç»å¯¹ä½ç½®æ¢ç®—åˆ°æ§ä»¶ä¸Šï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```cpp
if(ui->groupBox->geometry().contains(this->mapFromGlobal(QCursor::pos())))
```

<br>

### è·å–é¡¹ç›®ä¸­çš„ .svg å›¾ç‰‡èµ„æºï¼š

```cpp
case SP_DialogResetButton:
            icon = QIcon::fromTheme(QLatin1String("edit-clear"));
```

<br>

### åœ¨ main.cpp ä¸­ä¿®æ”¹æµ‹è¯•ä»£ç ï¼š

åœ¨ `qt5integration` çš„  main.cpp ä¸­, å¸¸ç”¨æµ‹è¯•ä»£ç å¦‚ä¸‹:

```cpp
#include <QApplication>
#include <QDebug>
#include <QFileInfo>
#include <QDebug>
#include <QTextBrowser>
#include <QWidget>
#include <QAction>
#include <QMenu>
#include <QList>
#include <QPalette>
#include <QPixmap>
#include <QWidget>
#include <DLineEdit>
#include <DPasswordEdit>
#include <DScrollBar>
#include <DListView>
#include <QStandardItemModel>
#include <DStandardItem>
#include <DDialog>

#include <DSuggestButton>
#include <DTitlebar>
#include <DComboBox>
#include <DProgressBar>
#include <QTimer>
#include <QDialog>


DWIDGET_USE_NAMESPACE

class ExWidget : public QWidget
{
public:
    explicit ExWidget();
    ~ExWidget();

    void init();

    void contextMenuEvent(QContextMenuEvent *event);
};

#include "widgetgallery.h"

int main(int argc, char *argv[])
{
    Q_INIT_RESOURCE(styles);

//    qputenv("QT_DEBUG_PLUGINS", "1");
    QStringList paths = QApplication::libraryPaths();
    paths.prepend(QFileInfo(QString::fromUtf8(argv[0])).path() + "/plugins");
    QApplication::setLibraryPaths(paths);

    QApplication app(argc, argv);

//    WidgetGallery gallery;
//    gallery.show();

//    DDialog *dialog = new DDialog("title", "mesg");
//    dialog->show();

    ExWidget* exWidget = new ExWidget();
    exWidget->show();

    return app.exec();
}

ExWidget::ExWidget()
{
    init();
}

ExWidget::~ExWidget()
{

}

void ExWidget::init()
{
    resize(1100, 720);
    setWindowTitle("example DTK");
//    moveToCenter(this);
    setContextMenuPolicy(Qt::DefaultContextMenu);

    //DTitlebar Test--------------------------------------------------------------
    DTitlebar* titleBar = new DTitlebar(this);
    titleBar->setQuitMenuDisabled(false);
    titleBar->move(0, 620);

    //--------------------------------------------------------------
//    QPalette pale = this->palette();
//    pale.setBrush(backgroundRole(),
//                  Qt::white); //çº¯ç™½
//                  Qt::black); //é»‘è‰²
//                  QPixmap("/home/muli/softFile/netWallPaper/700047.jpg"));
//                  QPixmap("/home/muli/softFile/netWallPaper/499786.png"));
//                  QPixmap("/home/muli/softFile/netWallPaper/20200326.png"));
//                  QPixmap("/home/muli/Desktop/20200327_104540.png"));
//    setPalette(pale);


    //DListView Test--------------------------------------------------------------
    DListView *listview = new DListView(this);
    QStandardItemModel *model = new QStandardItemModel();
    for (int i= 0; i < 10;i++) {
        DStandardItem *item = new DStandardItem(QString("%1%1%1%1").arg(i));
        model->appendRow(item);
    }
    listview->setModel(model);
    listview->resize(400, 600);
    listview->move(100, 100);
    listview->show();

    //DScrollbar Test--------------------------------------------------------------
//    DScrollBar * scrollbar = new DScrollBar(this);
//    scrollbar->move(50, 50);
////    scrollbar->show();

//    DScrollBar * scrollbar2 = new DScrollBar(this);
//    scrollbar2->setOrientation(Qt::Horizontal);
//    scrollbar2->move(200, 50);
////    scrollbar2->show();

    //DLineEdit Test--------------------------------------------------------------
//    DLineEdit* lineEdit = new DLineEdit(this);
//    lineEdit->resize(300, 40);
//    lineEdit->setEchoMode(QLineEdit::Password);
//    lineEdit->move(50, 40);

//    DPasswordEdit* passEdit = new DPasswordEdit(this);
//    passEdit->resize(300, 40);
//    passEdit->move(50, 100);

//    QLineEdit* edit = new QLineEdit(this);
//    edit->resize(300, 40);
//    edit->move(50, 150);
//    edit->setEchoMode(QLineEdit::Password);

    //DComboBox Test--------------------------------------------------------------
//    DComboBox* combobox = new DComboBox(this);
//    combobox->resize(300, 40);
//    combobox->addItem(QIcon::fromTheme("edit"), "test 01");
//    combobox->addItem(QIcon::fromTheme("button_add"), "test 02");
//    combobox->addItem(QIcon::fromTheme("edit"), "test 03");
//    combobox->addItem(QIcon::fromTheme("edit"), "test 04");
//    combobox->move(50, 200);

    //DPushButton Test--------------------------------------------------------------
//    btn = new DPushButton("this", this);
//    btn->resize(300, 50);
//    btn->move(50, 50);
//    btn->setGeometry(50,05,300,50);

//    btn2 = new DPushButton("this a", this);
//    btn2->resize(300, 50);
//    btn2->move(360, 50);

//    frame = new DFrame(this);
//    frame->resize(300, 50);
//    frame->move(50, 110);
////    DStyle::setFrameRadius(frame, 16);
//    frame->setStyleSheet("font: bold; font-size:20px; color: rgb(241, 70, 62)");
//    frame->setFrameRounded(true);

//    qDebug()<<"--01--"<<frame->rect();


//DProgressBar Test--------------------------------------------------------------

//    int nStar = 50;
//    DProgressBar *proBar1 = new DProgressBar(this);
//    proBar1->setOrientation(Qt::Horizontal);
//    proBar1->move(50, 50);
//    proBar1->resize(300, 50);
//    proBar1->setRange(0, 100);
//    proBar1->setValue(nStar);
////    proBar1->setAlignment(Qt::AlignCenter);
//    proBar1->show();

//    DProgressBar *proBar2 = new DProgressBar(this);
//    proBar2->setOrientation(Qt::Vertical);
//    proBar2->move(400, 50);
//    proBar2->resize(50, 300);
//    proBar2->setRange(0, 100);
//    proBar2->setValue(nStar);
//    proBar2->show();

//    DProgressBar *proBar3 = new DProgressBar(this);
//    proBar3->setOrientation(Qt::Horizontal);
//    proBar3->move(50, 200);
//    proBar3->resize(300, 8);
//    proBar3->setRange(0, 100);
//    proBar3->setValue(nStar);
////    proBar3->setAlignment(Qt::AlignCenter);
//    proBar3->show();

//    DProgressBar *proBar4 = new DProgressBar(this);
//    proBar4->setOrientation(Qt::Vertical);
//    proBar4->move(500, 50);
//    proBar4->resize(8, 300);
//    proBar4->setRange(0, 100);
//    proBar4->setValue(nStar);
//    proBar4->show();


//    QTimer *timer = new QTimer(this);
//    timer->start();
//    timer->setInterval(50);

//    connect(timer, &QTimer::timeout, [=](){
//        if (proBar1->value() >= 100)
//            proBar1->setValue(0);
//        proBar1->setValue(proBar1->value() + 1);

//        if (proBar2->value() >= 100)
//            proBar2->setValue(0);
//        proBar2->setValue(proBar2->value() + 1);

//        if (proBar3->value() >= 100)
//            proBar3->setValue(0);
//        proBar3->setValue(proBar3->value() + 1);

//        if (proBar4->value() >= 100)
//            proBar4->setValue(0);
//        proBar4->setValue(proBar4->value() + 1);
//        });

}

void ExWidget::contextMenuEvent(QContextMenuEvent *event)
{
    Q_UNUSED(event)

    QMenu* menu = new QMenu(this);
    for (int i = 0; i < 50; ++i) {
        QString str = QString("act   %1").arg(i);
        menu->addAction(str);
        menu->addSeparator();
    }
    menu->exec(QCursor::pos());
}

```

<br>

### ä¸‹è½½åœ°å€ï¼š

 [QtExamples](https://github.com/xmuli/QtExamples)

æ¬¢è¿ star å’Œ fork è¿™ä¸ªç³»åˆ—çš„ linux å­¦ä¹ ï¼Œé™„å­¦ä¹ ç”±æµ…å…¥æ·±çš„ç›®å½•ã€‚

