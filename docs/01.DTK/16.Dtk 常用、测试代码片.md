---
title: Dtk å¸¸ç”¨ã€æµ‹è¯•ä»£ç ç‰‡
date: 2020-12-10 15:40:03
permalink: /pages/968922/
---




ã€€ã€€**ç®€  è¿°ï¼š**ã€€`DTK` å¸¸ç”¨å’Œæµ‹è¯•ä»£ç ç‰‡ï¼Œåœ¨ `deepin 20` æˆ– `uos 20` ä¸­ï¼Œå…¨éƒ¨ä½¿ç”¨ `DTK` å¼€å‘ï¼Œå…¶ä¸­æœ‰ä¸€äº›æ˜¯ç»å¸¸é‡åˆ°çš„å®šä½ `bug` å’Œä¿®æ”¹çš„ä»£ç ç‰‡ã€‚åœ¨æ­¤æŠ›è½¬å¼•ç‰ï¼Œæäº¤ä¸€ç‚¹å¼€å‘çš„è´¡çŒ®

<!-- more -->

[TOC]

<br>

### å¼€å‘ç¯å¢ƒï¼š

ã€€ã€€**ğŸ’»ï¼š**  `uos 20` ğŸ“ `deepin 20` ğŸ“ `gcc/g++ 8.3` ğŸ“ `gdb8.0` 

<br>

### å°† dtkwidget é¡¹ç›®æ³¨å†Œåˆ°ç³»ç»Ÿï¼š

è¿™é‡Œä»¥ `dtkwidget` ä¸ºä¾‹ï¼Œå®ƒåœ¨ç³»ç»Ÿçš„åŠ¨æ€åº“æ˜¯å­˜æ”¾è·¯å¾„ä¸º `/usr/lib/x86_64-linux-gnu/`

 <img src="https://cdn.jsdelivr.net/gh/xmuli/xmuliPic@pic/2020/20200407_134649.png" width="100%"/>



- **è§£ç­”å›¾ç‰‡ï¼š**
  ç»è¿‡æµ‹è¯•ï¼Œç³»ç»Ÿåº“å’Œ DTK é¡¹ç›®çš„ç”Ÿæˆçš„ libdtkwidget.so å®é™…ä½¿ç”¨çš„éƒ½æ˜¯ æœ€æ–°çš„ 5.xxx ç‰ˆæœ¬ï¼Œè¿™é‡Œé¢çš„æ˜¯ .so.5.1.0ï¼›ç³»ç»Ÿåº“é‡Œé¢é—ç•™ä¸‹æ¥çš„ 2.xxx ç‰ˆæœ¬å¯èƒ½æ˜¯æä¾›ç»™æŸäº›æ²¡æœ‰v20ç‰ˆæœ¬çš„é¡¹ç›®ä½¿ç”¨çš„ã€‚
- è‹¥æ˜¯æƒ³è¦ä»£ç ç‰‡ç”Ÿæ•ˆçš„è¯ï¼Œåˆ™å°†é¡¹ç›®ç”Ÿæˆçš„ .so æ–‡ä»¶æ›¿ä»£æ¢æ‰ ç³»ç»Ÿè·¯å¾„ä¸‹ï¼Œè‹¥æ˜¯æœ‰æ–°çš„æ¥å£æ”¹åŠ¨ï¼Œé‚£ä¹ˆå¯¹åº”çš„å¤´æ–‡ä»¶ä¹Ÿè¦ä¸€èµ·æ›¿æ¢æ‰



```bash
#ã€å‘½ä»¤ï¼š 5.1.0 éœ€è¦æ›¿æ¢ä¸ºå®é™…çš„æœ€å¤§ã€‘
#[æ‹·è´äºŒè¿›åˆ¶æ–‡ä»¶ï¼š]
sudo rm -rf /usr/lib/x86_64-linux-gnu/libdtkwidget.so.5.1.0

sudo cp  ../build-dtkwidget-unknown-Debug/src/libdtkwidget.so.5.1.0 /usr/lib/x86_64-linux-gnu/

#[æ‹·è´å¤´æ–‡ä»¶ï¼š]
sudo cp /home/muli/project/dtkwidget/src/widgets/dslider.h /usr/include/libdtk-5.1.0/DWidget/
```



**PSï¼ˆuos / deepinï¼‰ï¼š**

å¯¹äº `dtkwidget` é¡¹ç›®ä¼šç”Ÿæˆ `libdtkwidget.so` åŠ¨æ€åº“ï¼›ç³»ç»Ÿå­˜æ”¾è·¯å¾„ä¸º `/usr/lib/x86_64-linux-gnu/` ï¼›

é¡¹ç›® `dtkgui` ä¼šç”Ÿæˆ `libdtkgui.so` åŠ¨æ€åº“æ–‡ä»¶ï¼›ç³»ç»Ÿå­˜æ”¾è·¯å¾„ä¸º `/usr/lib/x86_64-linux-gnu/` ï¼›

é¡¹ç›® `qt5integration` ä¼šç”Ÿæˆ `libchameleon.so` åŠ¨æ€åº“æ–‡ä»¶åœ¨ `./bin/plugins/styles/libchameleon.so  ` ä¸‹ ï¼›`/usr/lib/x86_64-linux-gnu/qt5/plugins/styles/`

```bash
sudo rm -rf /usr/lib/x86_64-linux-gnu/qt5/plugins/styles/libchameleon.so
sudo cp  ./bin/plugins/styles/libchameleon.so /usr/lib/x86_64-linux-gnu/qt5/plugins/styles/
```

<br>

<br>

### åˆ¤æ–­ ç³»ç»Ÿä¸»é¢˜æ˜¯æµ…è‰²è¿˜æ˜¯æš—è‰²ï¼š

```cpp
DGuiApplicationHelper *guiAppHelp = DGuiApplicationHelper::instance();
if (guiAppHelp->themeType() == DGuiApplicationHelper::ColorType::DarkType) {  //æš—è‰²ä¸»é¢˜

} else {  //æµ…è‰²ä¸»é¢˜

}
```

<br>

### å¯¹æŸä¸€é¢œè‰²ï¼Œåœ¨æµ… / æš—ä¸»é¢˜å¯¹å…¶äº®åº¦è¿›è¡Œä¿®æ”¹ï¼š

```cpp
//DGuiApplicationHelper::toColorType è·å–é¢œè‰²çš„æ˜äº®åº¦ï¼Œå°†å…¶è½¬æ¢ä¸ºä¸»é¢˜ç±»å‹çš„æšä¸¾å€¼ã€‚

QColor lineColor(opt->palette.color(QPalette::Base));
if (DGuiApplicationHelper::toColorType(lineColor) == DGuiApplicationHelper::LightType) {  //æ­¤é¢œè‰²åœ¨æµ…è‰²ä¸»é¢˜ä¸‹ï¼Œäº®åº¦ -10
	lineColor = DGuiApplicationHelper::adjustColor(color, 0, 0, -10, 0, 0, 0, 0);
} else {  //æ­¤é¢œè‰²åœ¨æš—è‰²è‰²ä¸»é¢˜ä¸‹ï¼Œäº®åº¦ +10
	lineColor = DGuiApplicationHelper::adjustColor(color, 0, 0, +10, 0, 0, 0, 0);
}
```

<br>

### å±æ€§çš„ä½¿ç”¨ï¼š

```cpp
Q_DECLARE_METATYPE(QMargins)
par->setProperty("_d_margins", QVariant::fromValue(margins));

QMargins magins = par->property("_d_margins").value<QMargins>();
if (par->property("_d_margins").isValid())
	content->setContentsMargins(QMargins(20, 0, 20, 0));
else
	content->setContentsMargins(magins);
```

<br>

### åœ¨ paintEvent() é‡Œé¢è·å–ä¸€ä¸ªé¢œè‰²ï¼š

```cpp
void SliderStrip::paintEvent(QPaintEvent *event)
{
    Q_UNUSED(event)
    QPainter pa(this);
    auto dpa = DApplicationHelper::instance()->palette(this);
    QPen penLine = QPen(dpa.textTips(), 1);
    QPen penNumber = QPen(dpa.color(DPalette::ObviousBackground), 1);
    
    pa.set(penLine);
}
```

<br>

### å°†è‡ªå®šä¹‰é£æ ¼ åº”ç”¨äº å…¶ä»–çš„è½¯ä»¶ï¼š

```bash
qtcreator -style windows

qtcreator -style chameleon
```

<br>

### æ‰“å° QBoxLayouté‡Œé¢çš„æ‰€æœ‰å…ƒç´ ï¼š

```cpp
for (int i = 0; i < d->hBoxLayout->count(); ++i) {
    QLayoutItem *item = (QLayoutItem *)d->hBoxLayout->itemAt(i);
    qDebug()<<i<<item->widget();
}
```

<br>

### QTåˆ¤æ–­é¼ æ ‡æ˜¯å¦åœ¨æŸå­çª—å£æ§ä»¶ä¸Šæ–¹ï¼š

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­çª—å£è·å–geometryï¼Œæ˜¯ç›¸å¯¹äºçˆ¶çª—å£çš„ç›¸å¯¹ä½ç½®ï¼ŒQCursor::pos()è·å–çš„æ˜¯é¼ æ ‡ç»å¯¹ä½ç½®ï¼Œè¦ä¸å°†çˆ¶çª—å£çš„ç›¸å¯¹ä½ç½®è¿›è¡Œæ¢ç®—ï¼Œè¦ä¸å°†é¼ æ ‡çš„ç»å¯¹ä½ç½®è¿›è¡Œæ¢ç®—ï¼Œè¿™é‡Œæœ¬æ–‡é‡‡ç”¨å°†é¼ æ ‡ç»å¯¹ä½ç½®æ¢ç®—åˆ°æ§ä»¶ä¸Šï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```cpp
if(ui->groupBox->geometry().contains(this->mapFromGlobal(QCursor::pos())))
```

<br>

### è·å–é¡¹ç›®ä¸­çš„ .svg å›¾ç‰‡èµ„æºï¼š

```cpp
case SP_DialogResetButton:
            icon = QIcon::fromTheme(QLatin1String("edit-clear"));
```

<br>

### ä¸‹è½½åœ°å€ï¼š

 [QtExamples](https://github.com/xmuli/QtExamples)

æ¬¢è¿ star å’Œ fork è¿™ä¸ªç³»åˆ—çš„ linux å­¦ä¹ ï¼Œé™„å­¦ä¹ ç”±æµ…å…¥æ·±çš„ç›®å½•ã€‚

